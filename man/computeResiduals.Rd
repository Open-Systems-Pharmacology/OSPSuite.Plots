% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utilities.R
\name{calculateResiduals}
\alias{calculateResiduals}
\title{Calculate Residuals}
\usage{
calculateResiduals(predicted, observed, scaling = ResidualScales$log)
}
\arguments{
\item{predicted}{A numeric vector of predicted values. Must have the same length as \code{observed}.}

\item{observed}{A numeric vector of observed values. Must have the same length as \code{predicted}.}

\item{scaling}{A character string specifying the scaling method. Must be one of:
\itemize{
\item \code{"log"} (default): Residuals are calculated as \code{log(predicted) - log(observed)}.
Invalid values (non-positive) or NA values are set to NA with a warning.
\item \code{"linear"}: Residuals are calculated as \code{predicted - observed}.
NA values are set to NA with a warning.
\item \code{"ratio"}: Residuals are calculated as \code{predicted / observed}.
Invalid values (zero observed values) or NA values are set to NA with a warning.
}}
}
\value{
A numeric vector of residuals with the same length as the input vectors.
Invalid calculations and NA values are returned as NA.
}
\description{
This function calculates residuals from predicted and observed values using different scaling methods.
The calculation method is consistent with the residual calculation used in \code{plotResVsCov()} and other
plotting functions in the ospsuite.plots package.
}
\details{
This function implements the same residual calculation logic used internally by
the ospsuite.plots package when creating residual plots with \code{plotResVsCov()} and
\code{plotRatioVsCov()}. It is provided as a standalone function to enable consistent
residual calculations across different packages in the Open Systems Pharmacology ecosystem.

\strong{Calculation Details:}
\itemize{
\item \strong{Log scaling}: \code{log(predicted) - log(observed)}
\itemize{
\item NA values are set to NA with a warning
\item Non-positive values are set to NA with a warning
\item Symmetric for over- and under-prediction on log scale
\item Commonly used for pharmacokinetic data
}
\item \strong{Linear scaling}: \code{predicted - observed}
\itemize{
\item NA values are set to NA with a warning
\item Standard residual calculation
\item Positive values indicate over-prediction
\item Negative values indicate under-prediction
}
\item \strong{Ratio scaling}: \code{predicted / observed}
\itemize{
\item Returns ratios instead of differences
\item NA values are set to NA with a warning
\item Zero observed values are set to NA with a warning
\item Values > 1 indicate over-prediction
\item Values < 1 indicate under-prediction
\item Value of 1 indicates perfect prediction
}
}
}
\examples{
# Example data
predicted <- c(1.5, 2.0, 3.5, 5.0, 7.5)
observed <- c(1.2, 2.1, 3.0, 5.5, 7.0)

# Calculate residuals with different scaling methods
residualsLog <- calculateResiduals(predicted, observed, scaling = "log")
residualsLinear <- calculateResiduals(predicted, observed, scaling = "linear")
residualsRatio <- calculateResiduals(predicted, observed, scaling = "ratio")

# Compare results
data.frame(
  predicted = predicted,
  observed = observed,
  logResiduals = residualsLog,
  linearResiduals = residualsLinear,
  ratioResiduals = residualsRatio
)

# Example with invalid values
predictedInvalid <- c(1.5, -2.0, 3.5)
observedInvalid <- c(1.2, 2.1, 0)

# Log scaling warns about non-positive values and returns NA
residualsLogInvalid <- calculateResiduals(predictedInvalid, observedInvalid, scaling = "log")

# Ratio scaling warns about zero observed values and returns NA
residualsRatioInvalid <- calculateResiduals(predictedInvalid, observedInvalid, scaling = "ratio")

}
