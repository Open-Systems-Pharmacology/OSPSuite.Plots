<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Box-Whisker Plots • ospsuite.plots</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Box-Whisker Plots">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ospsuite.plots</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ospsuite-plots.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Overview</h6></li>
    <li><a class="dropdown-item" href="../articles/ospsuite-plots.html">Overview</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Plotting functions</h6></li>
    <li><a class="dropdown-item" href="../articles/plot-time-profile.html">Time Profile Plots</a></li>
    <li><a class="dropdown-item" href="../articles/box-whisker-plots.html">Box-Whisker Plots</a></li>
    <li><a class="dropdown-item" href="../articles/histogram.html">Histogram Plots</a></li>
    <li><a class="dropdown-item" href="../articles/goodness-of-fit.html">Goodness of fit</a></li>
    <li><a class="dropdown-item" href="../articles/forest-plots.html">Forestplots</a></li>
    <li><a class="dropdown-item" href="../articles/range-plot-visualization.html">Range Plot Visualization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Box-Whisker Plots</h1>
            
      

      <div class="d-none name"><code>box-whisker-plots.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette documents and illustrates workflows for producing
box-and-whisker plots using the <code>ospsuite.plots</code> library.</p>
<p>The function for plotting box-whiskers is
<code>plotBoxWhisker</code>. Basic documentation of the function can be
found using: <code><a href="../reference/plotBoxWhisker.html">?plotBoxWhisker</a></code>. The output of the function is
a <code>ggplot</code> object.</p>
<div class="section level3">
<h3 id="setup">1.1 Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>This vignette uses the <a href="https://www.open-systems-pharmacology.org/OSPSuite.Plots/">ospsuite.plots</a> and
<a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a> libraries. We will use the default settings of
<a href="https://www.open-systems-pharmacology.org/OSPSuite.Plots/">ospsuite.plots</a> (see vignette(“ospsuite.plots”, package =
“ospsuite.plots”)) but will adjust the legend position and the alignment
of the caption.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.open-systems-pharmacology.org/OSPSuite.Plots/">ospsuite.plots</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set Defaults</span></span>
<span><span class="va">oldDefaults</span> <span class="op">&lt;-</span> <span class="fu">ospsuite.plots</span><span class="fu">::</span><span class="fu"><a href="../reference/setDefaults.html">setDefaults</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adjust default theme plot for prettier plots</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_update</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_update</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/get_theme.html" class="external-link">theme_update</a></span><span class="op">(</span>plot.caption <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-data">1.2 Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>This vignette uses a dataset provided by the package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkRatioData</span> <span class="op">&lt;-</span> <span class="va">exampleDataCovariates</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SetID</span> <span class="op">==</span> <span class="st">"DataSet1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SetID"</span>, <span class="st">"gsd"</span>, <span class="st">"AgeBin"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Agegroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">Age</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">60</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"infants"</span>, <span class="st">"school children"</span>, <span class="st">"adolescents"</span>, <span class="st">"adults"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pkRatioData</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span>, caption <span class="op">=</span> <span class="st">"First rows of example data pkRatioData"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>First rows of example data pkRatioData</caption>
<thead><tr class="header">
<th align="right">ID</th>
<th align="right">Age</th>
<th align="right">Obs</th>
<th align="right">Pred</th>
<th align="right">Ratio</th>
<th align="left">Sex</th>
<th align="left">Country</th>
<th align="right">SD</th>
<th align="left">Agegroup</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">48</td>
<td align="right">4.00</td>
<td align="right">2.90</td>
<td align="right">0.725</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.693</td>
<td align="left">adults</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">36</td>
<td align="right">4.40</td>
<td align="right">5.75</td>
<td align="right">1.307</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.188</td>
<td align="left">adults</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">52</td>
<td align="right">2.80</td>
<td align="right">2.70</td>
<td align="right">0.964</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.984</td>
<td align="left">adults</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">47</td>
<td align="right">3.75</td>
<td align="right">3.05</td>
<td align="right">0.813</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.591</td>
<td align="left">adults</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1.95</td>
<td align="right">5.25</td>
<td align="right">2.692</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.443</td>
<td align="left">infants</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">48</td>
<td align="right">2.45</td>
<td align="right">5.30</td>
<td align="right">2.163</td>
<td align="left">Male</td>
<td align="left">Canada</td>
<td align="right">0.072</td>
<td align="left">adults</td>
</tr>
</tbody>
</table>
<p>Metadata is a list that contains dimension and unit information for
dataset columns. If available, axis labels are set by this
information.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metaData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">exampleDataCovariates</span>, <span class="st">"metaData"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="../reference/metaData2DataFrame.html">metaData2DataFrame</a></span><span class="op">(</span><span class="va">metaData</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span>, caption <span class="op">=</span> <span class="st">"List of meta data"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>List of meta data</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Age</th>
<th align="left">Obs</th>
<th align="left">Pred</th>
<th align="left">SD</th>
<th align="left">Ratio</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">dimension</td>
<td align="left">Age</td>
<td align="left">Clearance</td>
<td align="left">Clearance</td>
<td align="left">Clearance</td>
<td align="left">Ratio</td>
</tr>
<tr class="even">
<td align="left">unit</td>
<td align="left">yrs</td>
<td align="left">dL/h/kg</td>
<td align="left">dL/h/kg</td>
<td align="left">dL/h/kg</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="examples">2. Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="examples-for-aggregation-of-categorical-data">2.1 Examples for Aggregation of Categorical Data<a class="anchor" aria-label="anchor" href="#examples-for-aggregation-of-categorical-data"></a>
</h3>
<div class="section level4">
<h4 id="minimal-example">2.1.1 Minimal Example<a class="anchor" aria-label="anchor" href="#minimal-example"></a>
</h4>
<p>Age (mapped to y) is aggregated.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pkRatioData</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Age</span><span class="op">)</span>, metaData <span class="op">=</span> <span class="va">metaData</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mappedData$doAdjustmentsWithMetaData(originalmapping = mapping, : No</span></span>
<span><span class="co">#&gt; metaData available for x-axis</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/minimal-example-1.png" alt="Box plot showing age distribution aggregated across all data. The plot displays quartiles with median line, showing the overall age range distribution." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="stratification-on-x-axis">2.1.2 Stratification on X-axis<a class="anchor" aria-label="anchor" href="#stratification-on-x-axis"></a>
</h4>
<p>Age (mapped to y) is aggregated for different countries (mapped to
x).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/example-x-stratification-1.png" alt="Box plots showing age distribution stratified by country. Separate box plots are displayed for each country on the x-axis, allowing comparison of age distributions between countries." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="stratification-by-color">2.1.3 Stratification by Color<a class="anchor" aria-label="anchor" href="#stratification-by-color"></a>
</h4>
<p>Age (mapped to y) is aggregated for different countries (mapped to
fill).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mappedData$doAdjustmentsWithMetaData(originalmapping = mapping, : No</span></span>
<span><span class="co">#&gt; metaData available for x-axis</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/minimal-example-color-1.png" alt="Box plot showing age distribution stratified by country using color coding. Different countries are represented by different fill colors in a single grouped box plot." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="stratification-by-color-and-on-x-axis">2.1.4 Stratification by Color and on X-axis<a class="anchor" aria-label="anchor" href="#stratification-by-color-and-on-x-axis"></a>
</h4>
<p>Age (mapped to <code>y</code>) is aggregated for different countries
(mapped to <code>x</code>) and Sex (mapped to <code>groupby</code>).
<code>groupby</code> is an additional aesthetic of
<a href="https://www.open-systems-pharmacology.org/OSPSuite.Plots/">ospsuite.plots</a> that works together with the variable
<code>groupAesthetics</code>. For the function
<code><a href="../reference/plotBoxWhisker.html">plotBoxWhisker()</a></code>, <code>groupAesthetics</code> is not
settable and is fixed to <code>fill</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    groupby <span class="op">=</span> <span class="va">Sex</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/minimal-example-color-x-1.png" alt="Box plots showing age distribution stratified by both country (x-axis) and sex (color/grouping). The plot displays separate box plots for each country, with different colors representing sex within each country." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="stratification-by-column-combination">2.1.5 Stratification by Column Combination<a class="anchor" aria-label="anchor" href="#stratification-by-column-combination"></a>
</h4>
<p>Below, <code>groupby</code> is mapped to a combination of the columns
“Sex” and “Country”:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    groupby <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Sex</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in mappedData$doAdjustmentsWithMetaData(originalmapping = mapping, : No</span></span>
<span><span class="co">#&gt; metaData available for x-axis</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/minimal-example-interaction-1.png" alt="Box plot showing age distribution grouped by the interaction of country and sex. Each combination of country and sex is represented as a separate group with distinct colors in the legend." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="omit-data-points-flagged-as-missing-dependent-variable-mdv">2.1.6 Omit Data Points Flagged as Missing Dependent Variable
(MDV)<a class="anchor" aria-label="anchor" href="#omit-data-points-flagged-as-missing-dependent-variable-mdv"></a>
</h4>
<p>If some of the data should be omitted, we can do this by mapping a
logical column to the aesthetic <code>mdv</code>. Below, we exclude data
from Germany:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    mdv <span class="op">=</span> <span class="va">Country</span> <span class="op">==</span> <span class="st">"Germany"</span>,</span>
<span>    groupby <span class="op">=</span> <span class="va">Sex</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/minimal-example-mdv-1.png" alt="Box plots showing age distribution by country and sex, with data from Germany excluded using the missing dependent variable (MDV) flag. The plot demonstrates how to omit specific data points from the analysis." width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="examples-for-box-whisker-vs-numeric-data">2.2 Examples for Box-Whisker vs Numeric Data<a class="anchor" aria-label="anchor" href="#examples-for-box-whisker-vs-numeric-data"></a>
</h3>
<div class="section level4">
<h4 id="numeric-data-as-factor">2.2.1 Numeric Data as Factor<a class="anchor" aria-label="anchor" href="#numeric-data-as-factor"></a>
</h4>
<p>In the next example, we added a numeric column as “mean age” of the
age group to the dataset. This column is mapped <em>as factor</em> to
<code>x</code>. The values are now displayed as categorical values
equidistant:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkRatioData</span> <span class="op">&lt;-</span> <span class="va">pkRatioData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Agegroup</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>meanAge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Age</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metaData</span><span class="op">[[</span><span class="st">"meanAge"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">metaData</span><span class="op">[[</span><span class="st">"Age"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">metaData</span> <span class="op">&lt;-</span> <span class="va">metaData</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pkRatioData</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">metaData</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">meanAge</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Agegroup</span></span>
<span>  <span class="op">)</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/numeric-example-factor-1.png" alt="Box plots showing ratio distribution by mean age treated as categorical factors. Each mean age value is positioned equidistantly on the x-axis, with different age groups represented by different fill colors." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="numeric-data-as-distinct-numeric-values">2.2.2 Numeric Data as Distinct Numeric Values<a class="anchor" aria-label="anchor" href="#numeric-data-as-distinct-numeric-values"></a>
</h4>
<p>If the column mapped to <code>x</code> is numeric and not a factor,
the x-position of the boxes corresponds to the numeric value:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">meanAge</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Agegroup</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/numeric-example-distinct-1.png" alt="Box plots showing ratio distribution by mean age as continuous numeric values. The x-position of each box plot corresponds to its actual numeric mean age value, with different age groups represented by different fill colors." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="map-continuous-column-with-binning">2.2.3 Map Continuous Column with Binning<a class="anchor" aria-label="anchor" href="#map-continuous-column-with-binning"></a>
</h4>
<p>By mapping <code>x</code> with a function, it is possible to
aggregate data of a continuous column into bins. Below, we use the
function <code>cut</code> to aggregate the data into 4 distinct bins
(see ?cut).</p>
<p>Attention: for <code>cut(Age)</code>, no <code>metaData</code>
exists. So we have to set the x label manually.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">Age</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Age range [years]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/numeric-example-bin4-1.png" alt="Box plots showing ratio distribution across four automatically generated age ranges. The continuous age variable is binned into four equal intervals, with each bin represented as a separate box plot on the x-axis." width="80%" style="display: block; margin: auto;"></p>
<p>We can use any function that converts a continuous vector to a
factor. Below, we define our own cut function simply as a wrapper around
<code>cut</code>, with some fixed arguments. This function is then
mapped to <code>x</code> and <code>groupby</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myCutfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">18</span>, <span class="fl">60</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"infants"</span>, <span class="st">"school children"</span>, <span class="st">"adolescents"</span>, <span class="st">"adults"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">myCutfun</span><span class="op">(</span><span class="va">Age</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    groupby <span class="op">=</span> <span class="fu">myCutfun</span><span class="op">(</span><span class="va">Age</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/numeric-example-binfunction-1.png" alt="Box plots showing ratio distribution across predefined age groups using a custom binning function. Ages are categorized into infants, school children, adolescents, and adults, with each group shown as a separate box plot." width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="aggregation-function">2.3 Aggregation Function<a class="anchor" aria-label="anchor" href="#aggregation-function"></a>
</h3>
<p>By default, the data is aggregated by percentiles defined by the
default option <code>ospsuite.plots.Percentiles</code>. The percentiles
can be customized for a specific plot by the input variable
<code>percentiles</code> or for all plots generated by
<code><a href="../reference/plotBoxWhisker.html">plotBoxWhisker()</a></code> by changing the default options
(<code>setOspsuite.plots.option(optionKey = OptionKeys$Percentiles, value = c(0.05, 0.25, 0.5, 0.75, 0.95))</code>).</p>
<p>It is also possible to use a customized function via the input
variable <code>statFun</code>. If <code>statFun</code> is not
<code>NULL</code>, it will overwrite the percentiles.</p>
<p><strong>Important</strong>: If you override the defaults this way,
please make sure to specify this in the plot annotations, as you are
essentially redefining a box plot, and the reader might misinterpret
it.</p>
<div class="section level4">
<h4 id="example-for-customized-percentiles">2.3.1 Example for Customized Percentiles<a class="anchor" aria-label="anchor" href="#example-for-customized-percentiles"></a>
</h4>
<p>In the example below, we do not show the whiskers by setting whisker
percentiles to box percentiles.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># B No whiskers</span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/customized-percentiles-1.png" alt="Box plots showing age distribution by country with customized percentiles. The whiskers are removed by setting both whisker percentiles equal to the box percentiles, showing only the interquartile range." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="example-for-customized-aggregation-function">2.3.2 Example for Customized Aggregation Function<a class="anchor" aria-label="anchor" href="#example-for-customized-aggregation-function"></a>
</h4>
<p>To customize the aggregation, provide a function that has as input
the vector to aggregate and as output a named list with entries
<code>ymin</code>, <code>lower</code>, <code>middle</code>,
<code>upper</code>, and <code>ymax</code>. In the example below, the
function <code>myStatFun</code> is provided, which uses mean and
standard deviation to aggregate:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStatFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    ymin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    middle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>,</span>
<span>    ymax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  statFun <span class="op">=</span> <span class="va">myStatFun</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Mean for the middle line, mean +/- standard deviation for the box edges, and mean +/- 1.96 standard deviation for the whiskers."</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/aggregation-functions-1.png" alt="Box plots showing age distribution by country using a custom aggregation function based on mean and standard deviation. The middle line represents the mean, box edges show mean ± SD, and whiskers extend to mean ± 1.96 SD." width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="tables-corresponding-to-plot">2.3.3 Tables Corresponding to Plot<a class="anchor" aria-label="anchor" href="#tables-corresponding-to-plot"></a>
</h3>
<p>As there already exist many possibilities to aggregate data in R,
this package does not provide an extra function to return the aggregated
data in a tabular form.</p>
<p>However, the <code><a href="../reference/plotBoxWhisker.html">plotBoxWhisker()</a></code> adds the aggregation
function to the plot object. So the aggregation can be easily done,
e.g., with the <a href="https://r-datatable.com" class="external-link">data.table</a> package using the same function
as used for the plot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate plot object</span></span>
<span><span class="va">plotObject</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Sex</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plotObject</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert data to data.table and use statFun saved in plotObject for aggregation</span></span>
<span><span class="co"># Make sure to add all relevant aesthetics to "by" columns</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">plotObject</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">plotObject</span><span class="op">$</span><span class="fu">statFun</span><span class="op">(</span><span class="va">Age</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="3%">
<col width="1%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="5%">
<col width="13%">
<col width="5%">
<col width="4%">
<col width="12%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">Country</th>
<th align="left">Sex</th>
<th align="right">N</th>
<th align="right">5th percentile</th>
<th align="right">25th percentile</th>
<th align="right">50th percentile</th>
<th align="right">75th percentile</th>
<th align="right">95th percentile</th>
<th align="right">arith mean</th>
<th align="right">arith standard deviation</th>
<th align="right">arith CV</th>
<th align="right">geo mean</th>
<th align="right">geo standard deviation</th>
<th align="right">geo CV</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Canada</td>
<td align="left">Male</td>
<td align="right">19</td>
<td align="right">1.80</td>
<td align="right">10.00</td>
<td align="right">34</td>
<td align="right">48.00</td>
<td align="right">55.30</td>
<td align="right">29.57895</td>
<td align="right">20.78813</td>
<td align="right">0.7028014</td>
<td align="right">0.00000</td>
<td align="right">NaN</td>
<td align="right">99.85178</td>
</tr>
<tr class="even">
<td align="left">Germany</td>
<td align="left">Male</td>
<td align="right">6</td>
<td align="right">1.00</td>
<td align="right">6.00</td>
<td align="right">28</td>
<td align="right">39.50</td>
<td align="right">53.00</td>
<td align="right">26.00000</td>
<td align="right">22.54773</td>
<td align="right">0.8672203</td>
<td align="right">10.94354</td>
<td align="right">6.561529</td>
<td align="right">128.19570</td>
</tr>
<tr class="odd">
<td align="left">Germany</td>
<td align="left">Female</td>
<td align="right">15</td>
<td align="right">5.90</td>
<td align="right">12.00</td>
<td align="right">37</td>
<td align="right">46.50</td>
<td align="right">53.30</td>
<td align="right">30.93333</td>
<td align="right">18.25794</td>
<td align="right">0.5902351</td>
<td align="right">22.18088</td>
<td align="right">2.949280</td>
<td align="right">67.91401</td>
</tr>
<tr class="even">
<td align="left">France</td>
<td align="left">Female</td>
<td align="right">10</td>
<td align="right">14.25</td>
<td align="right">20.25</td>
<td align="right">26</td>
<td align="right">43.25</td>
<td align="right">53.55</td>
<td align="right">30.60000</td>
<td align="right">15.45747</td>
<td align="right">0.5051460</td>
<td align="right">27.27291</td>
<td align="right">1.662613</td>
<td align="right">42.44874</td>
</tr>
</tbody>
</table>
<p><img src="box-whisker-plots_files/figure-html/aggregationTable-1.png" alt="Box plots showing age distribution by country and sex. This plot demonstrates how the aggregation function can be extracted from the plot object for creating corresponding data tables." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="show-outliers">2.4 Show Outliers<a class="anchor" aria-label="anchor" href="#show-outliers"></a>
</h3>
<div class="section level4">
<h4 id="outliers-with-default-settings">2.4.1 Outliers with Default Settings<a class="anchor" aria-label="anchor" href="#outliers-with-default-settings"></a>
</h4>
<p>Outliers are displayed if the variable <code>outliers</code> is TRUE.
Default outliers are flagged when outside the range from the “25th”
percentile - 1.5 x IQR to the “75th” percentile + 1.5 x IQR.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Country</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  outliers <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>tag <span class="op">=</span> <span class="st">"A"</span>, caption <span class="op">=</span> <span class="st">"Default settings: Whiskers indicate 90% range (5th - 95th percentile) and outliers indicate all measurements outside 25th percentiles - 1.5 x IQR to 75th percentiles + 1.5 x IQR."</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/example-outliers-1.png" alt="Box plots showing ratio distribution by sex and country with outliers displayed. Outliers are shown as individual points outside the whiskers, which indicate the 90% range (5th-95th percentile). Default outlier detection uses 1.5 × IQR beyond the quartiles." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="outliers-with-customized-settings">2.4.2 Outliers with Customized Settings<a class="anchor" aria-label="anchor" href="#outliers-with-customized-settings"></a>
</h4>
<p>In the following example, the aggregation is customized to set the
whiskers to 10% and 90% via the input variable <code>percentiles</code>,
and the outlier range is customized to show all points outside the
whiskers. For that, we define a function <code>myStatFunOutlier</code>,
which has as input the vector of the values and as output the vector of
values outside the outlier range.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myStatFunOutlier</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>, names <span class="op">=</span> <span class="cn">FALSE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">yOutsideRange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">y</span> <span class="op">&lt;</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="va">y</span> <span class="op">&gt;</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yOutsideRange</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">yOutsideRange</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Country</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outliers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  statFunOutlier <span class="op">=</span> <span class="va">myStatFunOutlier</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Whiskers indicate 80% range (10th - 90th percentile) and outliers indicate all measurements outside whiskers."</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/example-outliers-custom-1.png" alt="Box plots showing ratio distribution by sex and country with custom outlier detection. The whiskers indicate the 80% range (10th-90th percentile), and outliers show all measurements outside the whisker range." width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="retrieve-outliers-as-table">2.4.3 Retrieve Outliers as Table<a class="anchor" aria-label="anchor" href="#retrieve-outliers-as-table"></a>
</h4>
<p>The <code><a href="../reference/plotBoxWhisker.html">plotBoxWhisker()</a></code> adds the outlier function to the
plot object. So outliers can be easily retrieved, e.g., with the
<a href="https://r-datatable.com" class="external-link">data.table</a> package.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate plotObject</span></span>
<span><span class="va">plotObject</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Ratio</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Country</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outliers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  statFunOutlier <span class="op">=</span> <span class="va">myStatFunOutlier</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert data to data.table and use statFun saved in plotObject for aggregation</span></span>
<span><span class="co"># Make sure to add all relevant aesthetics to "by" columns</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">plotObject</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>outliers <span class="op">=</span> <span class="va">plotObject</span><span class="op">$</span><span class="fu">statFunOutlier</span><span class="op">(</span><span class="va">Ratio</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Country</th>
<th align="left">Sex</th>
<th align="right">outliers</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Canada</td>
<td align="left">Male</td>
<td align="right">2.692</td>
</tr>
<tr class="even">
<td align="left">Canada</td>
<td align="left">Male</td>
<td align="right">0.443</td>
</tr>
<tr class="odd">
<td align="left">Canada</td>
<td align="left">Male</td>
<td align="right">2.692</td>
</tr>
<tr class="even">
<td align="left">Canada</td>
<td align="left">Male</td>
<td align="right">0.527</td>
</tr>
<tr class="odd">
<td align="left">Germany</td>
<td align="left">Male</td>
<td align="right">5.333</td>
</tr>
<tr class="even">
<td align="left">Germany</td>
<td align="left">Male</td>
<td align="right">0.396</td>
</tr>
<tr class="odd">
<td align="left">Germany</td>
<td align="left">Female</td>
<td align="right">1.667</td>
</tr>
<tr class="even">
<td align="left">Germany</td>
<td align="left">Female</td>
<td align="right">1.565</td>
</tr>
<tr class="odd">
<td align="left">Germany</td>
<td align="left">Female</td>
<td align="right">0.260</td>
</tr>
<tr class="even">
<td align="left">Germany</td>
<td align="left">Female</td>
<td align="right">0.321</td>
</tr>
<tr class="odd">
<td align="left">France</td>
<td align="left">Female</td>
<td align="right">3.091</td>
</tr>
<tr class="even">
<td align="left">France</td>
<td align="left">Female</td>
<td align="right">0.255</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plot-configuration-of-boxplots">3. Plot Configuration of Boxplots<a class="anchor" aria-label="anchor" href="#plot-configuration-of-boxplots"></a>
</h2>
<p>Below you see an example of the same plot:</p>
<ul>
<li>A default layout</li>
<li>B customized layout</li>
<li>The variable <code>geomBoxplotAttributes</code> now has an entry for
color ‘orange’.</li>
<li>The variable <code>geomPointAttributes</code> now has an entry for
size = 4, color ‘orange’, and shape = ‘diamond’.</li>
<li>Fill is added to the mapping, so the outlier points are also colored
according to ‘Sex’.</li>
<li>With <code>scale_fill_manual</code>, the colors for ‘Sex’ are
defined.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A default layout</span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Sex</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outliers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  statFunOutlier <span class="op">=</span> <span class="va">myStatFunOutlier</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>tag <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># B customized layout</span></span>
<span><span class="fu"><a href="../reference/plotBoxWhisker.html">plotBoxWhisker</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pkRatioData</span>,</span>
<span>  metaData <span class="op">=</span> <span class="va">metaData</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Country</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Age</span>,</span>
<span>    fill <span class="op">=</span> <span class="va">Sex</span></span>
<span>  <span class="op">)</span>,</span>
<span>  outliers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  statFunOutlier <span class="op">=</span> <span class="va">myStatFunOutlier</span>,</span>
<span>  geomBoxplotAttributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"orange"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  geomPointAttributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"orange"</span>, shape <span class="op">=</span> <span class="st">"diamond"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Female <span class="op">=</span> <span class="st">"pink"</span>, Male <span class="op">=</span> <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>tag <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span></code></pre></div>
<p><img src="box-whisker-plots_files/figure-html/boxplot-update-configuration-1.png" alt="Two side-by-side box plots (A and B) showing age distribution by country and sex. Plot A shows default styling, while Plot B demonstrates custom styling with orange colors for boxes and diamond-shaped outlier points, plus custom fill colors for sex groups." width="80%" style="display: block; margin: auto;"><img src="box-whisker-plots_files/figure-html/boxplot-update-configuration-2.png" alt="Two side-by-side box plots (A and B) showing age distribution by country and sex. Plot A shows default styling, while Plot B demonstrates custom styling with orange colors for boxes and diamond-shaped outlier points, plus custom fill colors for sex groups." width="80%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/KatrinCoboeken" class="external-link">Katrin Coboeken</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
